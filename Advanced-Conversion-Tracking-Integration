Advanced Integration
Advanced Conversion Tracking Integration
Overview
This section provides technical specifications for advertisers integrating transaction tracking with CJ using the advanced iframe version of CJ's tracking tag.

Advertisers must work with a CJ Client Integration Engineer (CIE) to make any integration changes. Advertisers can contact Client Support or submit a request through the Support Center to be assigned a CIE to assist with integration changes.

This information is meant to serve as a guide and must be accompanied client-specific documentation provided by a CIE.

All integration changes must be tested along with a CIE before being pushed live, to avoid any breakages in tracking.

How CJ's Tracking Works
Advertisers send transaction data to CJ using a browser-based tracking tag. The tracking tags are only fired on the website's transaction confirmation page(s).

When a user clicks on a CJ link, a cookie is created in the browser, if a CJ cookie does not already exist. This cookie is assigned a surfer ID that persists in the user's browser. When the advertiser displays the tracking tag, CJ reads the surfer ID and looks for clicks and impressions for that user.

If CJ can find clicks or impressions for that user, then those are correlated to the transaction using Program Terms set up by the advertiser. If no clicks or impressions are found CJ looks for a click token in the conversion tag (CJ Event).

Actions
Actions are advertiser-defined behavior a customer must complete in order for a publisher to receive a commission. Actions can be either leads or sales, and can be sent using simple or advanced data. Your CJ team will help you determine with options are best for you.

Simple Transaction Tracking
Simple tracking requires the advertiser to send basic information about a transaction, like an order ID and order subtotal. This method works well when the advertiser does not want to track item-level data about a purchase or lead.

Advanced Transaction Tracking
Advanced tracking requires the advertiser to send item-level information about a purchase or lead. This method allows for product-level reporting and item-level commissioning.

Integration Options
CJ recommends that every advertiser integrates with an unconditional CJ tracking tag that fires for all transactions on their website. CJ recommends this method because it gives the advertiser access to Cross-Device Tracking and more robust reporting. If the advertiser chooses to conditionally fire their conversion tag, they cannot access Cross-Device Tracking.

Custom Parameters
CJ can pass URL parameters to the advertiser's website in the query string when a user clicks a CJ link. Advertisers can choose what name=value pairs they want passed. CJ has some standard values that can be passed, like the publisher website ID (PID or CJPID) and the link ID (AID or CJAID). Advertisers can also have custom name=value pairs to indicate, for example, that a user came from CJ (i.e. ref=cj or source=aff).

Cookie Requirements for Conditional Tags
If the advertiser chooses to apply conditional logic to their CJ tags, it is the advertiser’s responsibility to create their own cookie to track visitors who leave and return, in order to recognize that the visitor was initially CJ- referred and activate CJ-related tracking.

Last-click attribution must be used: the last network to send the visitor gets credit for the transaction

The cookie must be active for the Program Term's action referral period or longer, with a minimum of 24 hours

The user should also get credit for the same amount of occurrences as outlined in the Program Terms. This can vary from one occurrence to unlimited occurrences

Integrating the Conversion Tag
The conversion tag resides in the HTML body of your Thank You, confirmation, and/or receipt page, which displays following the valid sale or lead process. This page displays the final ordering information, including the order ID, the sale amount, and/or items sold, discounts applied, etc.

Your system must pass our script the following vital pieces of information:

The unique identifier (oid) specifically captured or generated during the order process

The item-level details of the transaction including SKU, unit quantity, and unit price

The CJEVENT value passed dynamically on click (See CJ Event ID for details)

The remaining parameters within the conversion tag are optional or static and can be hard-coded into the URL call for that IFRAME (see the table). You may place the conversion tag within any dynamic programming language.

Important: Use one tag on a confirmation page. Using multiple integration tags on one page interferes with performance.
Tag Parameter Summary
Parameter	Required
cid	Yes
oid	Yes
type	Yes
cjevent	Yes
currency	Yes
amtx	Yes
itemx	Yes
qtyx	Yes
dcntx	No
discount	Optional, see notes below.
coupon	Optional, see notes below.
channel	No, not to be used unless instructed by a CJ team member
channel_ts	No, not to be used unless instructed by a CJ team member
Conversion Tag Parameters
Note: Parameters are not case-sensitive.
Parameter	Description	Example	Required
cid	This value is set to the Enterprise ID, which is a static value provided by CJ.	cid=123456	Yes
oid	The OID is a unique identifier, such as an order identifier or invoice number, which must be populated for each order. It is used to reconcile orders in the advertiser's system with CJ in order to validate each sale or lead. This value will be truncated after the 96th character Only alphanumeric characters, dashes, and underscores can be included in the OID field CJ prohibits the submission of personally identifiable information in the OID field, such as a full or partial email address	oid=145_683-ABC	Yes
type	This is a static value provided by CJ; it is also called an Action ID in the Account Manager. Each account may have multiple actions and each will be referenced by a different TYPE value.	type=5634	Yes
cjevent	Unique CJ-generated token passed to your site, on click, that stores referring publisher data for cookieless attribution	cjevent=adlj3gw5WWjns97fgwsf	Yes
itemx	Advertiser-assigned Item ID value which populates dynamically into the string along with corresponding amtx and qtyx values. An item ID must be passed for each item in the cart. Additional Requirements:
The x value in the itemx must be an integer that follows an unbroken sequence of item1, item2 to differentiate each item involved in the cart.
A maximum of 100 sets of item-based values is supported for each order
The system supports an alphanumeric string with dashes or underscores only. Spaces and other characters are not permitted.
Item ID values must be less than or equal to 100 characters.
Example: item1=3214Sku	Yes
amtx	Amount parameter that corresponds to each individual item in the action (amt1 to item1, amt2 to item2, etc.). For example, a typical sale-related action would provide an amt parameter equal to that of the SKU's Unit Price (amount of one of that item). Do not adjust the amount when the quantity is greater than one (e.g., do not provide amtx=6.00 for two items at 3.00 each—see qtyx below). Requirements:
The corresponding value (e.g., 13.49) must be in the format of numbers, and may have a decimal point. No other characters, such as dollar signs ("\$") or commas (","), are supported by the CJ system. If a particular action will always have a subtotal of zero, you may hard-code a value of 0 into the code (e.g., amt1=0).
The x value must be an integer that follows an unbroken sequence of amt1, amt2, etc., to differentiate the amount for each item.
A maximum of 100 sets of item-based values (itemx / amtx / qtyx) is supported for each order.
If the currency name/value pair is omitted from the tracking string or if the value is empty, products default to the advertiser's functional currency.
The system assumes the amtx= value is in the currency specified in the currency parameter. If the advertiser specifies a currency other than the functional currency, the system converts the amtx= value to an amount in the functional currency using a current conversion rate.
Example: amt1=13.49	Yes
qtyx	Quantity parameter that corresponds to each item in the action (qty1 to item1, qty2 to item2, etc.). The qty value is multiplied by the amount value to determine the total for a given item (e.g., qty 2 of amt 3.00 would result in 6.00 being recorded in our system). Requirements:
The x value must be an integer (greater than or equal to 1) that follows an unbroken sequence of QTY1, QTY2, etc., to differentiate the quantity for each item.
A maximum of 100 sets of item-based values (itemx / amtx / qtyx) is supported for each order.

The qtyx field does not recognize decimal amounts. For example, qtyx=1.0 is read by the system as qtyx=10.
qty1=2	Yes
dcntx	Optional discount parameter that corresponds to each amt in the action (dcnt1 to amt1, dcnt2 to AMT2 etc.). The dcnt value represents the discount applied for the associated item.
The item level discount amount (dcntx) is spread across all items in the series which gives you the new individual item amount. That new amount is then multiplied by the quantity to get the subtotal for that item. (amtx -(dcntx/qtyx)) * qtyx).

For example, if amt1=10, qty1=2 and dcnt1=5 the new amount for each item is \$7.50 and the subtotal for item1 would be \$15.	dcnt1=5.55	No
discount	Discount parameter which enables you to apply a whole order discount to a transaction. An order which contains multiple items distributes the discount value throughout the items, based on the item amounts.	discount=12.99	No
currency	Identifies the currency used to determine the amt value for each item involved in the action. This three-letter code is static and can be hard-coded into the URL call for the image. If a code is not specified, product prices display in the advertiser’s functional currency. If a blank value is submitted (“currency=”, with no specified value), a transaction error will occur.
For a list of supported currencies and codes, please visit the Support Center.	currency=USD	Yes
coupon	Parameter for a coupon, voucher or discount code applied at the time of purchase.	coupon=10off100	No
container_tag_id	The unique identifier for the conversion tag.		Yes
name	If you have multiple conversion tags, you can use this parameter to uniquely identify your tags.		
channel	Only use this parameter if instructed by your assigned CJ Client Integration Engineer. This parameter is where the advertiser passes the channel to which they attribute the last click. See the table below for acceptable values and their meanings.		No
channel_ts	Only use this parameter if instructed by your assigned CJ Client Integration Engineer.

This parameter is where the advertiser passes the date/time stamp for the last click that they are attributing the transaction to. They must use this format:
format: yyyy-mm-ddThh24:mm:ss.sssZ
all dates and times must be in UTC
the .toISOString() method in javaScript to produces this format
this is the only format CJ's system will accept
channel_ts=2017-02-14T22:16:46.623Z	No
Channel Parameter Values
Channel Parameter Value	When To Use It	Elligible For CJ Commissions
cj	When the customer's last click was from a CJ affiliate link	Yes
direct	When the customer navigated directly to the advertiser's website Important: Do not overwrite other channels with 'direct'. If there is a click for another marketing channel before a user navigates directly to the site, the 'channel' parameter must reflect that previous click.	Yes
affiliate_other	When the customer's last click was from an affiliate channel other than CJ	No
display	When the customer's last click was from a display campaign	No
social	When the customer's last click was from a social media campaign	No
search	When the customer's last click was from a search campaign	No
email	When the customer's last click was from an email campaign	No
other	When the customer's last click was from a campaign not defined by the values above	No

Note:

CJ will consider a transaction eligible for commission in the following scenarios: channel=cj channel=direct channel=[unrecognized value] channel=[blank] * channel does not exist in tag
The parameter name and values are not case sensitive
If 'direct' is not included as a 'channel' value, the advertiser is not eligible for cross-device tracking
Conversion Tag Examples
The following are examples of the conversion tag for advanced conversion tracking integration.

These coding examples are provided as a courtesy and for your reference only. These examples may not work for your specific shopping cart or web site. CJ does not guarantee the accuracy of these coding examples.

Remember that the tracking tag should be placed within the HTML body of the order’s Thank You, confirmation, and/or receipt page following the order or application process.

The AMOUNT and OID variables are populated after submission of the action.

Placeholders with brackets denote the location of required values. Brackets are for illustration purposes only, and should NOT be placed in the actual code.

In the example, the TYPE value is paired with a CJ-assigned Action ID number, which identifies the action that has occurred.

Once the conversion tag has been configured to dynamically place the transaction information needed by CJ to process orders, place the final version of the conversion tag within the HTML body of the advertiser’s order confirmation page. Place the conversion tag near the top of the page within the opening and closing body \<BODY> tags with no visible line breaks.

At this point, Technical Services will verify action integration to ensure the placement of the correct data.

Advanced Conversion Tracking Integration HTML Example
<!-- BEGIN CJ TRACKING CODE – DO NOT MODIFY -->
<iframe height="1" width="1" frameborder="0" scrolling="no" src="https://www.emjcd.com/tags/c?containerTagId=<CONTAINERID>&ITEM1=<ITEM1>&AMT1=<AMT1>&QTY1=<QTY1>&ITEM2=<ITEM2>&AMT2=<AMT2>&QTY2=<QTY2>&CJEVENT=<CJEVENTID>&COUPON=<COUPONCODE>&CID=<ENTERPRISEID>&OID=<OID>&TYPE=<ACTIONID>&CURRENCY=<CURRENCY>" name=Conversion tag> </iframe>
<!-- END CJ TRACKING CODE -->
Advanced Conversion Tracking Integration JavaScript Example
<!-- BEGIN CJ TRACKING CODE - DO NOT MODIFY -->

<script type="text/javascript" language="Javascript">
 var count;
 var url = 'https://www.emjcd.com/tags/c?containerTagId=<CONTAINERID>&CID=<ENTERPRISEID>&TYPE=<ACTIONID>&CURRENCY=<CURRENCY>';
 url += '&OID=' + Order[0];
 url += '&CJEVENT=' + cjevent;

 for (var count = 1; count <= OrderDetails.length; count++) {
 if (OrderDetails[count - 1][2] != undefined) {
 url += '&ITEM' + count + '=' + OrderDetails[count - 1][2];
 url += '&AMT' + count + '=' + OrderDetails[count - 1][5];
 url += '&QTY' + count + '=' + OrderDetails[count - 1][6];
 }
 }
 document.write('<iframe height="1" width="1" frameborder="0" scrolling="no" name="cj_conversion" src="' + url +
'"></iframe>');
</script>



<!-- END CJ TRACKING CODE -->
Advanced Conversion Tracking Integration ASP Example
<% Username = Request.Form("Username") Password = Request.Form("password")
Contact_Name = Request.Form("Contact_Name") Phone = Request.Form("Phone")
Credit_Card = Request.Form("Credit_Card") Address = Request.Form("address") Hosting_Plan =
Request.Form("Subtotal")
Card_Number = Request.Form("Card_Number") Expiration = Request.Form("Expiration") Name_On_Card =
Request.Form("Name_On_Card")
%> Thank you, <% = Contact_Name %> for your order.</center><br></td></tr>
<tr><td>Hosting Plan: <td><% = Subtotal %><br></td><tr>
<tr><td><p>Username: <td><% = Username %><br></td></tr>
<tr><td>Password: <td><% = Password %></td></tr></table><br> <p>
<!-- BEGIN CJ TRACKING CODE - DO NOT MODIFY -->
<iframe height="1" width="1" frameborder="0" scrolling="no"
src="https://www.emjcd.com/tags/c?containerTagId=<CONTAINERID>&CID=<ENTERPRISEID>&OID=<ORDERID>&
TYPE=<ACTIONID>&ITEM1=<ITEM1-SKU>&AMT1=<ITEM1-Amount>&QTY1=<ITEM1-Quantity>&ITEM2=<ITEM2-SKU>&AMT2=<ITEM2-Amount>&QTY2=<ITEM2-Quantity>&CJEVENT=<CJEVENTID>&CURRENCY=<CURRENCY>”> name="Conversion
tag"></iframe></font></td>
